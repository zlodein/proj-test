# .htaccess для Presentation Realty
# Путь: /public_html/.htaccess

# Включение движка перезаписи
RewriteEngine On
RewriteBase /

# Перенаправление /view/{hash} на view.php?hash={hash}
RewriteRule ^view/([a-f0-9]{32})$ view.php?hash=$1 [L,QSA]

# Запрещаем прямой доступ к API без авторизации (кроме публичных презентаций)
RewriteCond %{QUERY_STRING} action=generate_presentation [NC]
RewriteCond %{QUERY_STRING} !hash= [NC]
RewriteCond %{REQUEST_METHOD} GET
RewriteCond %{HTTP:Authorization} !^Basic [NC]
RewriteCond %{HTTP_COOKIE} !PHPSESSID=
RewriteRule ^api\.php$ - [F]

# Защита от доступа к системным файлам
RewriteRule ^(config|includes|src|api-data|editor-data)($|/) - [F,L]

# Отключение отображения содержимого директорий
Options -Indexes

# Кодировка по умолчанию
AddDefaultCharset UTF-8

# Защита конфигурационных файлов
<FilesMatch "\.(htaccess|htpasswd|ini|log|sh|sql|conf|env)$">
    Order Allow,Deny
    Deny from all
</FilesMatch>

# Защита директорий
<IfModule mod_rewrite.c>
    RewriteRule ^config/ - [F,L]
    RewriteRule ^src/ - [F,L]
    RewriteRule ^logs/ - [F,L]
    RewriteRule ^includes/ - [F,L]
</IfModule>

# Сжатие GZIP
<IfModule mod_deflate.c>
    AddOutputFilterByType DEFLATE text/html text/plain text/xml text/css text/javascript
    AddOutputFilterByType DEFLATE application/javascript application/x-javascript application/json
</IfModule>

# Кэширование
<IfModule mod_expires.c>
    ExpiresActive On
    ExpiresDefault "access plus 1 month"
    ExpiresByType text/html "access plus 0 seconds"
    ExpiresByType text/css "access plus 1 year"
    ExpiresByType application/javascript "access plus 1 year"
    ExpiresByType image/jpeg "access plus 1 year"
    ExpiresByType image/png "access plus 1 year"
    ExpiresByType image/webp "access plus 1 year"
</IfModule>

# Безопасность заголовков
<IfModule mod_headers.c>
    Header set X-Frame-Options "SAMEORIGIN"
    Header set X-Content-Type-Options "nosniff"
    Header set X-XSS-Protection "1; mode=block"
</IfModule>

# PHP настройки
<IfModule mod_php7.c>
    php_value upload_max_filesize 10M
    php_value post_max_size 15M
    php_value max_execution_time 300
    php_value memory_limit 256M
</IfModule>
